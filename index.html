<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>cube</title>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
</head>

<body>
  <a-scene light="defaultLightsEnabled: false">
    <a-assets>
      <audio id="audio-music-modern" src="assets/MusicModern.mp3" preload="auto" loop="true"></audio>
      <audio id="audio-music-Old" src="assets/MusicOld.mp3" preload="auto" loop="true"></audio>
      <audio id="audio-bell-ring" src="assets/BellRing.wav"></audio>

      <a-asset-item id="asset-desk-modern" src="assets/DeskModern.glb"></a-asset-item>
      <a-asset-item id="asset-desk-old" src="assets/DeskOld.glb"></a-asset-item>
      <a-asset-item id="asset-bell" src="assets/DeskBell.glb"></a-asset-item>
      <a-asset-item id="asset-periph" src="assets/SourisClavier.glb"></a-asset-item>
      <a-asset-item id="asset-imac" src="assets/iMac.glb"></a-asset-item>
      <a-asset-item id="asset-stairs-modern" src="assets/StairsModern.glb"></a-asset-item>
      <a-asset-item id="asset-entrance-modern" src="assets/EntranceModern.glb"></a-asset-item>

      <a-asset-item id="asset-light-modern" src="assets/LightModern.glb"></a-asset-item>

      <!-- DECOR -->

      <img id="tex-mount-modern" src="assets/MountModern.png">
      <img id="tex-mount-old" src="assets/MountOld.png">
      <img id="tex-sol-modern" src="assets/SolModern.jpg">
      <img id="tex-sol-old" src="assets/SolOld.jpg">
      <img id="tex-mur-modern" src="assets/MurModern.jpg">
      <img id="tex-mur-old" src="assets/MurOld.jpg">
      <img id="tex-plafond-modern" src="assets/PlafondModern.jpg">
      <img id="tex-plafond-old" src="assets/PlafondOld.jpg">
    </a-assets>

    <!-- Utilisation du mod√®le GLTF -->

    <!-- BUREAU -->

    <a-entity id="le-bureau-modern" gltf-model="#asset-desk-modern" position="-0.088 0.891 -7.163" scale="0.04 0.04 0.05">
    </a-entity>
    
    <a-entity id="le-bureau-old" gltf-model="#asset-desk-old" position="-0.088 0.891 -7.163" scale="0.04 0.04 0.05" visible="false">
    </a-entity>

    <a-entity id="la-sonnette" position="-0.122 1.109 -5.503" time-travel="startModern: false">
      <a-entity gltf-model="#asset-bell" scale="10 10 10"></a-entity>
      <a-sphere class="clickable" radius="0.15" material="transparent: true; opacity: 0" position="0 0 0"></a-sphere>
    </a-entity>

    <a-entity id="groupe-elements-modernes">

      <a-entity id="periph-gauche" gltf-model="#asset-periph" position="-1.166 -1.692 -6.640" scale="3 3 3"
        rotation="0 180 0"></a-entity>
      <a-entity id="imac-gauche" gltf-model="#asset-imac" position="-1.541 1.12 -5.828" scale="0.3 0.3 0.3"
        rotation="0 -15.65 0"></a-entity>

      <a-entity id="periph-droit" gltf-model="#asset-periph" position="1.294 -1.692 -6.640" scale="3 3 3"
        rotation="0 180 0"></a-entity>
      <a-entity id="imac-droit" gltf-model="#asset-imac" position="1.319 1.12 -5.828" scale="0.3 0.3 0.3"
        rotation="0 12.88 0"></a-entity>

    </a-entity>

    <!-- STRUCTURE -->

    <a-plane id="sol-principal" src="#tex-sol-modern" repeat="8 8" position="0 0 1.1" rotation="-90 0 0" width="40"
      height="40" geometry="height: 22; width: 23.59" roughness="0.3" metalness="0.1">
    </a-plane>


    <a-plane id="base" position="0 -0.82283 0" rotation="-90 0 0" width="40" height="40" color="#CCCCCC"></a-plane>
    <a-plane id="plafond" src="#tex-plafond-modern" position="0 6 1.27847" rotation="90 0 0" width="40" height="40"
      color="#FFF" geometry="height: 22; width: 24"></a-plane>
    <a-plane id="base-up" position="0 8 0" rotation="90 0 0" width="40" height="40" color="#FFF"></a-plane>

    <a-box id="mur-fond" src="#tex-mur-modern" repeat="4 2" position="0 4 -9.70" width="20" height="8" depth="0.5">
    </a-box>

    <a-box id="mur-gauche" src="#tex-mur-modern" repeat="4 2" position="-10 4 0" rotation="0 90 0" width="20" height="8"
      depth="0.5">
    </a-box>

    <a-box id="mur-droit" src="#tex-mur-modern" repeat="4 2" position="10 4 0" rotation="0 90 0" width="20" height="8"
      depth="0.5">
    </a-box>

    <a-entity id="escalier-droit-bas" gltf-model="#asset-stairs-modern" position="6.302 -0.08 -0.32"
      scale="0.32 0.25 0.25" rotation="1.03 -90 0.61"></a-entity>
    <a-entity id="escalier-droit-haut" gltf-model="#asset-stairs-modern" position="6.302 -0.10 -1.97"
      scale="-0.32 0.25 0.25" rotation="1.03 -90 0.61"></a-entity>

    <a-box id="mur-stairs-d-1" src="#tex-mur-modern" repeat="4 2" position="7.49 4 6.19" rotation="0 90 0" width="11.61"
      height="8" depth="3"></a-box>
    <a-box id="mur-stairs-d-2" src="#tex-mur-modern" repeat="4 2" position="7.99 4 -6.73" rotation="0 90 0" width="8"
      height="8" depth="4"></a-box>

    <a-entity id="escalier-gauche-bas" gltf-model="#asset-stairs-modern" position="-6.302 -0.10 -0.37"
      scale="-0.32 0.25 0.25" rotation="1.03 90 0.61"></a-entity>
    <a-entity id="escalier-gauche-haut" gltf-model="#asset-stairs-modern" position="-6.302 -0.08 -2.00"
      scale="0.32 0.25 0.25" rotation="1.03 90 0.61"></a-entity>

    <a-box id="mur-stairs-g-1" src="#tex-mur-modern" repeat="4 2" position="-7.49 4 6.19" rotation="0 90 0"
      width="11.61" height="8" depth="3"></a-box>
    <a-box id="mur-stairs-g-2" src="#tex-mur-modern" repeat="4 2" position="-7.99 4 -6.73" rotation="0 90 0" width="8"
      height="8" depth="4"></a-box>

    <a-entity id="entrance-modern" gltf-model="assets/EntranceModern.glb" position="-6.4 0.3165 4.23841"
      rotation="0 90 0" scale="1 1.4 1.06"></a-entity>
    <!-- LIGHT -->
    <a-entity id="light-modern" gltf-model="assets/LightModern.glb" position="-4.19 5.94218 -5" scale="0.5 0.5 0.5">
      <a-light type="point" intensity="0.6" distance="20" decay="2" color="#FFEECC"></a-light>
    </a-entity>
    <a-entity id="light-modern-2" gltf-model="assets/LightModern.glb" position="3.90998 5.94218 -5" scale="0.5 0.5 0.5">
      <a-light type="point" intensity="0.6" distance="20" decay="2" color="#FFEECC"></a-light>
    </a-entity>
    <a-entity id="light-modern-3" gltf-model="assets/LightModern.glb" position="-4.19 5.94218 7" scale="0.5 0.5 0.5">
      <a-light type="point" intensity="0.6" distance="20" decay="2" color="#FFEECC"></a-light>
    </a-entity>
    <a-entity id="light-modern-4" gltf-model="assets/LightModern.glb" position="3.90998 5.94218 7" scale="0.5 0.5 0.5">
      <a-light type="point" intensity="0.6" distance="20" decay="2" color="#FFEECC"></a-light>
    </a-entity>
    <a-entity id="light-modern-5" gltf-model="assets/LightModern.glb" position="-0.122 5.942 1" scale="1 1 1">
      <a-light type="point" intensity="0.8" distance="25" decay="2" color="#FFEECC"></a-light>
    </a-entity>


    <!-- √âclairage global -->
    <a-entity light="type: ambient; color: #FFF; intensity: 0.2"></a-entity>
    <a-entity light="type: directional; color: #FFF; intensity: 0.3" position="0 10 5"></a-entity>
    <a-entity light="type: hemisphere; color: #FFF; groundColor: #888; intensity: 0.15"></a-entity>


    <!-- DECOR EXT-->
    <a-plane id="decor-exterieur" src="#tex-mount-modern" position="0 -20 40" rotation="0 180 0" width="100" height="60"
      material="shader: flat; fog: false">
    </a-plane>

    <a-box position="0 4 5" width="30" height="10" depth="1" color="#333" side="back" visible="false"> </a-box>


    <!-- CAMERA -->
    <a-entity id="camera-rig" position="0 1.5 -2.75">

      <a-entity camera look-controls wasd-controls>

        <a-entity cursor="rayOrigin: mouse; fuse: false" 
                  raycaster="objects: .clickable; far: 50; interval: 100">
        </a-entity>

      </a-entity>
    </a-entity>

    <!-- SONS -->

    <a-sound id="sound-emitter" src="#audio-music-modern" autoplay="false" loop="true" positional="false" volume="0.3">
    </a-sound>

  </a-scene>

  <script type="module" src="/src/main.js"></script>
  <script>
    console.log('üöÄ Script charg√©!');

    // COMPOSANT VOYAGE DANS LE TEMPS
    AFRAME.registerComponent('time-travel', {
      schema: {
        startModern: { type: 'boolean', default: true } // LE BOUTON MAGIQUE POUR LES D√âVELOPPEURS
      },
      init: function () {
        console.log('üîß Composant time-travel initialis√©');
        // On initialise l'√©tat actuel selon ton param√®tre
        this.isModern = this.data.startModern;

        // On lance la mise √† jour visuelle tout de suite
        this.updateScene();

        // On √©coute le clic sur la sonnette
        this.el.addEventListener('click', () => {
          console.log('üîî CLIC SUR LA SONNETTE!');
          
          // Jouer le son de la sonnette
          const bellAudio = document.querySelector('#audio-bell-ring');
          if (bellAudio) {
            bellAudio.currentTime = 0; // Remettre au d√©but
            bellAudio.play().catch(e => console.error('Erreur lecture sonnette:', e));
          }
          
          this.isModern = !this.isModern; // On inverse l'√©tat (Vrai -> Faux -> Vrai)
          this.updateScene();
        });

        // Logs pour le hover
        this.el.addEventListener('mouseenter', () => {
          console.log('üëÜ Souris sur la sonnette');
        });
      },

      updateScene: function () {
        const isModern = this.isModern;
        console.log("Mode Moderne activ√© :", isModern);

        // 1. CHANGEMENT DES TEXTURES (Murs, Sol, Plafond, Dehors)
        // Syntaxe : condition ? valeur_si_vrai : valeur_si_faux

        document.querySelector('#sol-principal').setAttribute('src', isModern ? '#tex-sol-modern' : '#tex-sol-old');
        document.querySelector('#plafond').setAttribute('src', isModern ? '#tex-plafond-modern' : '#tex-plafond-old');

        // Murs (On boucle sur tous les murs pour faire propre)
        const murs = ['#mur-fond', '#mur-gauche', '#mur-droit', '#mur-stairs-d-1', '#mur-stairs-d-2', '#mur-stairs-g-1', '#mur-stairs-g-2'];
        murs.forEach(id => {
          document.querySelector(id).setAttribute('src', isModern ? '#tex-mur-modern' : '#tex-mur-old');
        });

        // Decor Ext√©rieur
        document.querySelector('#decor-exterieur').setAttribute('src', isModern ? '#tex-mount-modern' : '#tex-mount-old');

        // 2. GESTION DES OBJETS 3D (Cacher / Montrer)
        // On cache le groupe "moderne" si on est en "vieux", et inversement
        const groupeModerne = document.querySelector('#groupe-elements-modernes');
        if (groupeModerne) groupeModerne.setAttribute('visible', isModern);

        // (Plus tard tu cr√©eras un #groupe-elements-vintage et tu feras l'inverse : !isModern)

        // 3. GESTION DE LA MUSIQUE
        const audioModern = document.querySelector('#audio-music-modern');
        const audioOld = document.querySelector('#audio-music-Old');
        
        console.log('üéµ Changement de musique:', isModern ? 'Modern' : 'Old');
        
        if (isModern) {
          // Passer en mode moderne
          if (audioOld) {
            audioOld.pause();
            audioOld.currentTime = 0;
          }
          if (audioModern) {
            audioModern.play().catch(e => console.error('Erreur MusicModern:', e));
          }
        } else {
          // Passer en mode ancien
          if (audioModern) {
            audioModern.pause();
            audioModern.currentTime = 0;
          }
          if (audioOld) {
            audioOld.play().catch(e => console.error('Erreur MusicOld:', e));
          }
        }
      }
    });

    // Force le son √† se lancer apr√®s l'initialisation d'A-Frame
    document.addEventListener('DOMContentLoaded', function () {
      const scene = document.querySelector("a-scene");
      let audioStarted = false;
      
      scene.addEventListener("loaded", function() {
        console.log('üé¨ Sc√®ne A-Frame charg√©e');
        
        function startAudio() {
          if (audioStarted) return;
          
          console.log('üîä Tentative de lancement du son...');
          
          // Essayer de lancer avec A-Frame sound component
          const soundEntity = document.querySelector("#sound-emitter");
          if (soundEntity && soundEntity.components && soundEntity.components.sound) {
            try {
              soundEntity.components.sound.playSound();
              audioStarted = true;
              console.log("‚úÖ Son A-Frame activ√© avec succ√®s!");
            } catch(e) {
              console.error("‚ùå Erreur A-Frame son:", e);
            }
          }
          
          // Alternative: lancer directement l'audio HTML5
          const audioModern = document.querySelector('#audio-music-modern');
          const audioOld = document.querySelector('#audio-music-Old');
          
          if (audioModern) {
            audioModern.play().then(() => {
              console.log("‚úÖ MusicModern lanc√©e!");
              audioStarted = true;
            }).catch(e => console.error("‚ùå Erreur MusicModern:", e));
          }
        }
        
        // Essayer de lancer le son au premier clic
        document.addEventListener('click', startAudio, { once: false });
        
        // Message pour l'utilisateur
        console.log('üëÜ Cliquez pour activer le son');
      });
    });
  </script>
</body>

</html>